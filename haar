% from toolbox/vision/visiondemos, move "stopSignImages" to working directory
% this contains your positive training set

% load('stopSigns.mat');

% now define path to negative training set
imDir = fullfile(matlabroot,'toolbox','vision','visiondemos','stop_signs_64x64');
addpath(imDir);
negativeFolder = fullfile(matlabroot,'toolbox','vision','visiondemos','non_stop_signs');

negativeFolder_nmj = fullfile(pwd,'negative');

% train detector
% trainCascadeObjectDetector('stopSignDetector.xml',data,negativeFolder,'FalseAlarmRate',0.2,'NumCascadeStages',5);
trainCascadeObjectDetector('stopSignDetector.xml',positiveInstances_nmj,negativeFolder_nmj,'FalseAlarmRate',0.2,'NumCascadeStages',5);
% instantiate detector
detector = vision.CascadeObjectDetector('stopSignDetector.xml');

%% load test image
img = imread('TMR_7166_14.tif');

% generate prediction
bbox = step(detector,img);

% generate new image
% detectedImg = insertObjectAnnotation(img,'rectangle',bbox,'stop sign');
detectedImg = insertObjectAnnotation(img,'rectangle',bbox,'NMJ');

% show guess
imshow(detectedImg)
