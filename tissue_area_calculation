tic

% following visual inspection, load csv file
list_of_images = csvread('section_area_calculations.csv');

% connect to limsdb

for i = 1:length(list_of_images)
    
    % establish connection
    conn = database('limsdb','lims','mou53Brains!');
    curs = exec(conn,[]);

    % read data ID
    data_id = list_of_images(i, 1);

    % for each data ID, retrieve corresponding slides_id from limsdb.data_file
    sql = ['SELECT slides_id FROM data_file WHERE id = "' num2str(data_id) '"'];
    curs = exec(conn,sql);
    curs = fetch(curs);
    slides_id = cell2mat(curs.Data);

    % using slides_id, retreive source_lens from limsdb.slides
    sql = ['SELECT source_lens FROM slides WHERE id = "' num2str(slides_id) '"'];
    curs = exec(conn,sql);
    curs = fetch(curs);
    source_lens = cell2mat(curs.Data);
    
    % define physical dimensions per pixel
    if source_lens == 20;
        dimensions = .465 ^2;
    else
        dimensions = (.465/2)^2;
    end
    
    % calculate area
    area = dimensions * list_of_images(i, 2);
    
    % update record in limsdb
    
    % select attribute
    colnames = {'tissue_surface_area'};

    % store tissue surface area in array
    data = {round(area)/1000000}; 

    % identify relevant record via data_id (and not slide ID)
    whereclause = strcat('where id = ', num2str(data_id));

    % update record 
    update(conn,'data_file', colnames,data, whereclause);
      
end

% close connection
commit(conn);
close(conn);  

toc

    